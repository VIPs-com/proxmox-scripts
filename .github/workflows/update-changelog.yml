name: ğŸ“œ Auto Update CHANGELOG

on:
  push:
    branches: [main]
    paths:
      - 'scripts/proxmox-postinstall-aurora-luna.sh'
  workflow_dispatch:

jobs:
  changelog:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: ğŸ”„ Checkout do repositÃ³rio
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: âš™ï¸ Configurar Git
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"

    - name: ğŸ“ Atualizar CHANGELOG.md
      run: |
        TODAY=$(date +'%Y-%m-%d')

        # Cria o arquivo se nÃ£o existir
        if [ ! -f CHANGELOG.md ]; then
          echo "# ğŸ“œ CHANGELOG - Proxmox Scripts" > CHANGELOG.md
          echo "" >> CHANGELOG.md
        fi

        # Verifica se jÃ¡ existe entrada hoje
        if grep -q "## [$TODAY]" CHANGELOG.md; then
          echo "âœ… Entrada jÃ¡ existe para hoje. Nada a fazer."
          exit 0
        fi

        # Adiciona entrada no topo do arquivo
        TEMP_FILE=$(mktemp)
        {
          echo "## [$TODAY]"
          echo "- ğŸ“¦ Script 'proxmox-postinstall-aurora-luna.sh' atualizado automaticamente"
          echo ""
          cat CHANGELOG.md
        } > "$TEMP_FILE" && mv "$TEMP_FILE" CHANGELOG.md

    - name: ğŸš€ Commit e Push
      run: |
        git add CHANGELOG.md
        git commit -m "ğŸ“œ Auto-update CHANGELOG for $TODAY" || echo "â„¹ï¸ Nenhuma mudanÃ§a para commitar"
        git push origin main
